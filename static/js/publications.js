const audioElement=document.querySelector("audio"),audioCtx=new AudioContext,track=audioCtx.createMediaElementSource(audioElement),playButton=document.querySelector(".b2b-player-play"),playIcon=playButton.querySelector(".b2b-player-play-icon"),pauseIcon=playButton.querySelector(".b2b-player-pause-icon"),progress=document.querySelector(".b2b-player-timeline"),progressFilled=document.querySelector(".b2b-player-timeline-filled"),playerCurrentTime=document.querySelector(".b2b-player-time-current"),playerDuration=document.querySelector(".b2b-player-time-duration"),volumeControl=document.querySelector(".b2b-player-volume"),volume=document.querySelector(".b2b-player-volume input"),volumeIcon=document.querySelector(".b2b-player-volume-icon"),speedList=document.querySelectorAll(".b2b-player-speed li"),speedContainer=document.querySelector(".b2b-player-speed"),currentSpeed=document.querySelector(".b2b-player-speed-current"),gainNode=audioCtx.createGain();volume.addEventListener("input",(e=>{const t=parseFloat(e.target.value);0===t?volumeControl.classList.add("muted"):volumeControl.classList.remove("muted"),isFinite(t)&&(gainNode.gain.value=t);const n=t/parseFloat(volume.max)*100;volume.style.background=`linear-gradient(to right, #A1A3AD ${n}%, #E5E5E8 ${n}%)`})),volumeIcon.addEventListener("click",(e=>{volumeIcon.parentElement.classList.add("muted"),volume.value=0,volume.dispatchEvent(new Event("input",{bubbles:!0}))})),volume.dispatchEvent(new Event("input",{bubbles:!0})),window.addEventListener("load",(()=>{function removeActiveFromList(e){for(let t=0;t<e.length;t++)e[t].classList.remove("active")}setTimes(),audioElement.addEventListener("timeupdate",(()=>{progressUpdate(),setTimes()})),playButton.addEventListener("click",(()=>{"suspended"===audioCtx.state&&audioCtx.resume(),"false"===playButton.dataset.playing?(audioElement.play(),playButton.dataset.playing="true",playIcon.classList.add("b2b-hidden"),pauseIcon.classList.remove("b2b-hidden")):"true"===playButton.dataset.playing&&(audioElement.pause(),playButton.dataset.playing="false",pauseIcon.classList.add("b2b-hidden"),playIcon.classList.remove("b2b-hidden"))}));for(let e=0;e<speedList.length;e++)speedList[e].addEventListener("click",(t=>{currentSpeed.innerText=speedList[e].innerText,audioElement.playbackRate=speedList[e].dataset.value,removeActiveFromList(speedList),speedList[e].classList.add("active"),speedContainer.classList.remove("hover"),event.stopPropagation()}),!0);function setTimes(){playerCurrentTime.textContent=new Date(1e3*audioElement.currentTime).toISOString().substr(14,5),playerDuration.textContent=new Date(1e3*audioElement.duration).toISOString().substr(14,5)}function progressUpdate(){const e=audioElement.currentTime/audioElement.duration*100;progressFilled.style.flexBasis=`${e}%`}speedContainer.addEventListener("mouseenter",(()=>{speedContainer.classList.add("hover")})),speedContainer.addEventListener("click",(()=>{speedContainer.classList.add("hover")})),speedContainer.addEventListener("mouseleave",(()=>{speedContainer.classList.remove("hover")})),speedContainer.addEventListener("focusout",(()=>{speedContainer.classList.remove("hover")})),audioElement.addEventListener("ended",(()=>{playButton.dataset.playing="false",pauseIcon.classList.add("hidden"),playIcon.classList.remove("hidden"),progressFilled.style.flexBasis="0%",audioElement.currentTime=0,audioElement.duration=audioElement.duration})),track.connect(gainNode).connect(audioCtx.destination);let e=!1;function scrub(e){const t=e.offsetX/progress.offsetWidth*audioElement.duration;audioElement.currentTime=t,progressUpdate()}progress.addEventListener("click",scrub),progress.addEventListener("mousemove",(t=>e&&scrub(t))),progress.addEventListener("mousedown",(()=>e=!0)),progress.addEventListener("mouseup",(()=>e=!1))}),!1);